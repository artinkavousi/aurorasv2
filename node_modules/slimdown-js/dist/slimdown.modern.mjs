const e=[],n=[],t=[],l=[],r=[],s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},p=new RegExp(`[${Object.keys(s).join("")}]`,"g"),h=e=>e.replace(p,e=>s[e]),g=(e,n)=>{const t=n.trim();return/^<\/?(ul|ol|li|h|p|bl|table|tbody|tr|td|th|caption)/i.test(t)||""===t?`\n${n}\n`:`\n<p>\n${t}\n</p>\n`},o=e=>{if(0===e.length)return"";let n="";const t=[];for(let l=0;l<e.length;l++){const r=e[l],s=l<e.length-1?e[l+1]:null;for(;t.length>0&&t[t.length-1].level>r.level;){const e=t.pop();e.hasOpenLi&&(n+="</li>"),n+=`</${e.type}>`}if(t.length>0&&t[t.length-1].level===r.level&&t[t.length-1].type!==r.type){const e=t.pop();e.hasOpenLi&&(n+="</li>"),n+=`</${e.type}>`}(0===t.length||t[t.length-1].level<r.level)&&(n+=`<${r.type}>`,t.push({type:r.type,level:r.level,hasOpenLi:!1})),t.length>0&&t[t.length-1].hasOpenLi&&t[t.length-1].level===r.level&&(n+="</li>",t[t.length-1].hasOpenLi=!1),n+=`<li>${r.content}`,t[t.length-1].hasOpenLi=!0,(!s||s.level<=r.level)&&(n+="</li>",t[t.length-1].hasOpenLi=!1)}for(;t.length>0;){const e=t.pop();e.hasOpenLi&&(n+="</li>"),n+=`</${e.type}>`}return n},i=(e,n,t,l="")=>{const r=t.split("|").filter((e,n,t)=>n>0&&n<t.length-1).map(e=>/:-+:/g.test(e)?"center":/-+:/g.test(e)?"right":/:-+/.test(e)?"left":""),s=e=>{const n=r[e];return n?` align="${n}"`:""},p=n.split("|").slice(1,-1),h=p.map(e=>e.trim()),g=[];let o=0;for(let e=0;e<h.length;e++){if(o>0){o--;continue}const n=h[e];if(n&&n.length){let t=1,l=!1;for(let n=e+1;n<h.length&&0===h[n].length;n++)if(""===p[n]){l=!0;break}if(l)for(let n=e+1;n<h.length&&0===h[n].length;n++)t++;t>1?(o=t-1,g.push(`<th${s(e)} colspan="${t}">${n}</th>`)):g.push(`<th${s(e)}>${n}</th>`)}else g.push(`<th${s(e)}></th>`)}return`\n<table><tbody><tr>\n  ${g.join("\n  ")}\n</tr>\n${l.split("\n").map(e=>e.trim()).filter(e=>e&&e.length).map(e=>{const n=e.split("|").slice(1,-1),t=n.map(e=>e.trim()),l=[];let r=0;for(let e=0;e<t.length;e++){if(r>0){r--;continue}const p=t[e];if(p&&p.length){let h=1,g=!1;for(let l=e+1;l<t.length&&0===t[l].length;l++)if(""===n[l]){g=!0;break}if(g)for(let n=e+1;n<t.length&&0===t[n].length;n++)h++;h>1?(r=h-1,l.push(`<td${s(e)} colspan="${h}">${p}</td>`)):l.push(`<td${s(e)}>${p}</td>`)}else l.push(`<td${s(e)}></td>`)}return`<tr>\n  ${l.join("\n  ")}\n</tr>\n`}).join("")}</tbody></table>\n`},a=[[/\r\n/g,"\n"],[/\n(#+)(.*)/g,(e,n,t="")=>{const l=n.length;return`<h${l}>${t.trim()}</h${l}>`}],[/!\[([^\[]+)\]\((?:javascript:)?([^\)]+)\)/g,'<img src="$2" alt="$1">'],[/\[([^\[]+)\]\((?:javascript:)?([^\)]+)\)/g,'<a href="$2">$1</a>'],[/([^\\])(\*\*|__)(.*?(_|\*)?)\2/g,"$1<strong>$3</strong>"],[/([^\\])(\*|_)(.*?)\2/g,"$1<em>$3</em>"],[/\\_/g,"&#95;"],[/\~\~(.*?)\~\~/g,"<del>$1</del>"],[/\:\"(.*?)\"\:/g,"<q>$1</q>"],[/\n-{3,}/g,"\n<hr />"],[/\n( *)[-*+] \[([xX ])\](.*)/g,(e,n,t,l)=>`\n{{LISTITEM:ul:${Math.floor(n.length/2)}:<input type="checkbox"${"x"===t.toLowerCase()?" checked":""} disabled> ${l.trim()}}}\n`],[/\n( *)(\*|-|\+)(.*)/g,(e,n,t,l)=>`\n{{LISTITEM:ul:${Math.floor(n.length/2)}:${l.trim()}}}\n`],[/\n( *)([0-9]+\.) (.*)/g,(e,n,t,l)=>`\n{{LISTITEM:ol:${Math.floor(n.length/2)}:${l.trim()}}}\n`],[/\n(&gt;|\>)(.*)/g,(e,n,t="")=>`\n<blockquote>${t.trim()}</blockquote>`],[/(\^)(.*?)\1/g,"<sup>$2</sup>"],[/(\~)(.*?)\1/g,"<sub>$2</sub>"],[/\n\[(.+?)\]\n( *\|[^\n]+\|\r?\n)((?: *\|:?[ -]+:?)+ *\|)(\n(?: *\|[^\n]+\|\r?\n?)*)?/g,(e,n,t,l,r="")=>i(0,t,l,r).replace("<table>",`<table><caption>${n.trim()}</caption>`)],[/( *\|[^\n]+\|\r?\n)((?: *\|:?[ -]+:?)+ *\|)(\n(?: *\|[^\n]+\|\r?\n?)*)?/g,i],[/\[\^([^\]]+)\](?!:)/g,(e,n)=>`<sup id="fnref:${n}"><a href="#fn:${n}">[${n}]</a></sup>`],[/\[\^([^\]]+)\]:\s*((?:[^\n]*\n?)*)/g,(e,n,t)=>(r.push([n,t.trim()]),"")],[/\n([A-Z][A-Za-z\s]*?)\s:\s*([A-Z][^\n]*)/g,(e,n,t)=>`\n<dl><dt>${n.trim()}</dt><dd>${t.trim()}</dd></dl>\n`]],c=[[/\s?<\/[ou]l>\s?<[ou]l>/g,"",3],[/<\/blockquote>\n<blockquote>/g,"<br>\n"],[/https?:\/\/[^"']*/g,e=>e.replace(/<\/?em>/g,"_")],[/&#95;/g,"_"]],$=(s,p=!1,i=!1)=>(e.length=0,n.length=0,t.length=0,l.length=0,r.length=0,s=(e=>e.replace(/\$([^$\n]+)\$/g,(e,n)=>(l.push(n),`{{INLINEMATHPH${l.length-1}}}`)))(s=(e=>e.replace(/`([^`]+)`/g,(e,t)=>(n.push(t),`{{INLINECODEPH${n.length-1}}}`)))(s=(e=>e.replace(/\n\s*\$\$([^]*?)\$\$\s*\n/g,(e,n)=>(t.push(n.trim()),`\n{{MATHBLOCKPH${t.length-1}}}\n`)))(s=(n=>n.replace(/\n\s*```\w*\n([^]*?)\n\s*```\s*\n/g,(n,t)=>(e.push(t),`\n<pre>{{CODEBLOCKPH${e.length-1}}}</pre>\n`)))(`\n${s}\n`)))),a.forEach(([e,n,t=1])=>{for(let l=0;l<t;l++)s=s.replace(e,n)}),s=(s=(e=>{if(!e.includes("{{LISTITEM:"))return e;const n=e.split("\n"),t=[];let l=[],r=!1;for(const e of n){const n=e.match(/\{\{LISTITEM:([^:]+):([^:]+):(.+)\}\}/);if(n){const s=n[1],p=parseInt(n[2]);if(r&&l.length>0){const e=l[l.length-1];e.type!==s&&e.level===p&&(t.push([...l]),l=[])}l.push({type:s,level:p,content:n[3],originalLine:e}),r=!1}else""!==e.trim()?(l.length>0&&(t.push([...l]),l=[]),r=!1):""===e.trim()&&(r=!0)}if(l.length>0&&t.push(l),0===t.length)return e;for(const n of t){const t=o(n);e=e.replace(n[0].originalLine,t);for(let t=1;t<n.length;t++)e=e.replace(n[t].originalLine,"")}return e})(s)).replace(/\n([^\n]+)\n/g,g),c.forEach(([e,n,t=1])=>{for(let l=0;l<t;l++)s=s.replace(e,n)}),s=(s=(e=>e.replace(/{{INLINEMATHPH(\d+)}}/g,(e,n)=>{const t=l[parseInt(n)];return`<span class="math-inline">${h(t)}</span>`}))(s=(e=>e.replace(/{{INLINECODEPH(\d+)}}/g,(e,t)=>{const l=n[parseInt(t)];return`<code>${h(l)}</code>`}))(s=(e=>e.replace(/{{MATHBLOCKPH(\d+)}}/g,(e,n)=>{const l=t[parseInt(n)];return`<div class="math-block">${h(l)}</div>`}))(s=(n=>n.replace(/<pre>{{CODEBLOCKPH(\d+)}}<\/pre>/g,(n,t)=>{const l=e[parseInt(t)];return`<pre>${h(l)}</pre>`}))(s))))).trim()+(0===r.length?"":`\n<div class="footnotes">\n  <hr>\n  <ol>\n    ${r.map(([e,n])=>`\n    <li id="fn:${e}">\n      ${n}\n      <sup><a href="#fnref:${e}">â†©</a></sup>\n    </li>`).join("\n")}\n  </ol>\n</div>`),p&&(s=s.replace(/^<p>([\s\S]*)<\/p>$/,"$1")),i&&(s=s.replace(/<a href="/g,'<a target="_blank" href="')),s),u=(e,n)=>{a.push([e,n])};export{u as addRule,$ as render};
//# sourceMappingURL=slimdown.modern.mjs.map
